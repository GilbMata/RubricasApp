import{c as G,d as H}from"./QList.2fbf911b.js";import{b as k,c as B,a as I,C as x,g as j,as as U,_ as L,E as Z,r as m,z as J,aL as W,at as w,G as C,H as K,I as t,J as s,L as _,aM as Q,P as g,aN as A,aO as V,R as q,M as X,aP as E,S as d,ax as u,aQ as P,n as S,aR as R,Q as p,aS as Y}from"./index.667e992f.js";import{Q as $,C as z}from"./ClosePopup.aa7f118d.js";import{Q as D}from"./QForm.d24a03ec.js";import{Q as ee}from"./QPage.a8222513.js";import{a as N}from"./authHeader.bc06fe4e.js";import"./position-engine.a6141200.js";import"./selection.2879ee5e.js";import"./format.c860d4da.js";const ae=k("div",{class:"q-space"});var se=B({name:"QSpace",setup(){return()=>ae}}),le=B({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(r,{slots:e}){const i=j(),a=I(()=>"q-td"+(r.autoWidth===!0?" q-table--col-auto-width":"")+(r.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(r.props===void 0)return k("td",{class:a.value},x(e.default));const f=i.vnode.key,v=(r.props.colsMap!==void 0?r.props.colsMap[f]:null)||r.props.col;if(v===void 0)return;const{row:l}=r.props;return k("td",{class:a.value+v.__tdClass(l),style:v.__tdStyle(l)},x(e.default))}}});class oe{async allUser(){try{return await U.get("/users")}catch(e){return console.error(e),e}}async saveUser(e){console.log("\u{1F680} ~ saveUser ~ user:",e);try{return await U.post("/user/new",{email:e.email,firstname:e.firstname,lastname:e.lastname,school:e.school,occupation:e.occupation,gender:e.gender,age:e.age,password:e.password})}catch(i){return console.error(" Error",i),i}}async saveAccess(e){try{return await U.post(`/useracces/${e.uuid}`,{password:e.password})}catch(i){return console.error(" Error",i),i}}async delUser(e){try{return await U.delete(`/user/${e}`,{})}catch(i){return console.log(JSON.stringify(i.data)),i}}async editUser(e){console.log(e);try{const i=await U.put(`/user/${e.id}`,{headers:N(),data:{username:e.username,email:e.email,pass:e.pass,role:e.role}});return console.log(i),i}catch(i){return i}}getUser(e){return U.get(`/user/${e}`,{headers:N()})}}var h=new oe;const re=[{name:"firstname",label:"Nombre",field:"name",align:"left",sortable:!0},{name:"apellido",label:"Apellido",field:"lastname",align:"left",sortable:!0},{name:"email",label:"Correo",field:"email",align:"left"},{name:"age",label:"Edad",field:"age",align:"center"},{name:"gender",label:"Genero",field:"gender",align:"center"},{name:"occupation",label:"Occupacion",field:"occupation",align:"center"},{name:"school",label:"Estudios",field:"school",align:"center"},{name:"action",label:"Actions",field:"action",align:"center"}],te={setup(){Z();const r=m(null);var e=m([]),i=m(!1),a=m(!1),f=m({firstname:"Eduo",lastname:"Perez",age:"14",gender:"m",occupation:"mmm",school:"m",email:"egdu@edu.com"}),v=m({}),l=m({password:"",passwordconfirm:""});J(()=>{b(!0)});const n=m({length:!1,capital:!1,number:!1,symbol:!1,same:!1});return{dialog_add:i,dialog_access:a,columns:re,users:e,editedUser:f,accesUser:v,editedAccess:l,saveAcces:O,ispassword:m(!0),valid:!1,roles:["Admin","User"],myForm:r,getUsers:b,saveUser:M,onReset:T,nameRules:[o=>!!o||"Se requiere el nombre",o=>o&&o.length>=5||"El nombre debe ser mas de 5 caracteres"],email:"",emailRules:[o=>!!o||"Correo electronico es requerido",o=>/^[\w-]+@([\w-]+\.)+[\w-]{2,4}$/.test(o)||"El email debe ser v\xE1lido"],passwordRules:[o=>!!o||"Se requiere contrase\xF1a",o=>/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z])(?=.*[^\w\d\s]).{6,}$/.test(o)||"La contrase\xF1a debe contener al menos una letra min\xFAscula, un n\xFAmero, un car\xE1cter especial y una letra may\xFAscula"],passwordConfirmRules:[o=>o&&o===f.value.password||"Debe coincidir con la contrase\xF1a."],validatePasswor:F,validPassword:n,delUser(o){W.create({title:"Eliminar!",message:"\xBFDeseas eliminar el usuario?"}).onOk(()=>{h.delUser(o.uuid).then(c=>{w.create({icon:"done",color:"positive",message:"Registro borrado"})}).catch(c=>{w.create({icon:"error",color:"negative",message:"Error en la solicitud"})}).finally(b())})}};function T(){f.value={},l.value={},i.value=!1}function b(o=!1){h.allUser().then(c=>{e.value=c.users,o&&w.create({icon:"done",color:"positive",message:"Datos cargados",timeout:1500})}).catch(c=>{console.log(c),w.create({icon:"report_problem",color:"negative",message:"Error de conexi\xF3n",progress:!0})})}function M(o){console.log("\u{1F680} ~ saveUser ~ user",o),r.value.validate().then(c=>{c?(o.id?h.editUser(o).then(y=>{y.status==200?(f.value={},this.showEditDialog(),this.snackbar={text:"Usuario actualizado",show:!0}):console.log(y.message)}):h.saveUser(o).then(y=>{f.value={},w.create({icon:"done",color:"positive",message:"Usuario guardado"}),this.dialog_add=!1}).catch(y=>{console.log(y),w.create({icon:"error",color:"negative",message:y})}).finally(b()),b()):console.log("\u{1F680} ~ Form validate ~ Error")})}function O(o){o&&h.saveAccess(o).then(c=>{w.create({icon:"done",color:"positive",message:"Accesos actualizados"}),this.dialog_access=!1}).catch(c=>{console.log("\u{1F680} ~ UserService.saveAccess ~ error:",c)}).finally(b())}function F(o){if(!!o)return n.value.length=o.length>=6,n.value.capital=/^(?=.*[A-Z]).*$/.test(o),n.value.number=/^(?=.*[0-9]).*$/.test(o),n.value.symbol=/^(?=.*[^\w\d\s]).*$/.test(o),n.value.same=this.editedAccess.password===this.editedAccess.passwordconfirm,n.value.length&&n.value.capital&&n.value.number&&n.value.symbol}},methods:{editUser(r){console.log("\u{1F680} ~ editUser ~ user:",r),this.dialog_add=!this.dialog_add,!r&&this.dialog_add==!1&&this.getUsers()},editAccess(r){this.editedAccess.uuid=r.uuid,this.editedAccess.rol=r.roles[0].name,this.dialog_access=!this.dialog_access,!r&&this.dialog_add==!1&&this.getUsers()},showEditpassword(r){r?this.editpassword.id=r:(this.editpassword={},this.pass2=""),this.dialog2=!this.dialog2},savePass(r){console.log(r),r.id&&h.editUser(r).then(e=>{e.status==200?(this.editedUser={},this.showEditpassword(),this.snackbar={text:"Contrase\xF1a actualizada",color:"success",show:!0}):console.log(e)})}}},ie=d("div",null,"\xA1No se encontro ning\xFAn dato!",-1),ne={key:0,class:"text-h6"},de={key:1,class:"text-h5 text-center q-pt-xs"},ce={class:"q-pa-md q-gutter-y-md"},me={class:"row wrap q-gutter-md"},ue={class:"row wrap q-gutter-md"},fe={class:"row q-gutter-md"},ve=d("div",{class:"text-h5 text-center"},"Accesos",-1),ge={class:"q-pa- q-gutter-y-md"},pe=d("div",{class:"text-subtitle2 q-mb-sm"}," Criterios de contrase\xF1a: ",-1);function we(r,e,i,a,f,v){return C(),K(ee,{padding:""},{default:t(()=>[s(A,{class:"q-pa-xs"},{default:t(()=>[s($,{dense:"",title:"Usuarios",rows:a.users,columns:a.columns,"row-key":"name","items-per-page":10,"sort-by":"firstname"},{top:t(()=>[s(G,{class:"shdow-1"},{default:t(()=>[s(H,null,{default:t(()=>[_(" Usuarios ")]),_:1}),s(se),s(Q,{inset:""}),s(g,{color:"primary",label:"Agregar",icon:"fa-solid fa-plus",onClick:e[0]||(e[0]=l=>a.dialog_add=!0)})]),_:1})]),"no-data":t(()=>[ie]),"body-cell-action":t(l=>[s(le,{props:l},{default:t(()=>[s(g,{dense:"",flat:"",color:"yellow",field:"access",icon:"fa-solid fa-key",onClick:n=>v.editAccess(l.row)},null,8,["onClick"]),s(g,{dense:"",flat:"",color:"primary",field:"edit",icon:"fa-solid fa-pencil",onClick:n=>v.editUser(l.row)},null,8,["onClick"]),s(g,{dense:"",flat:"",color:"negative",field:"edit",icon:"fa-solid fa-trash-can",onClick:n=>a.delUser(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1}),s(R,{modelValue:a.dialog_add,"onUpdate:modelValue":e[9]||(e[9]=l=>a.dialog_add=l),persistent:"","transition-show":"flip-down","transition-hide":"flip-up"},{default:t(()=>[s(A,{class:"items-center justify-center"},{default:t(()=>[s(V,null,{default:t(()=>[a.editedUser.id?(C(),q("div",ne," Editando "+X(a.editedUser.firstname),1)):(C(),q("div",de,"Nuevo"))]),_:1}),s(D,{ref:"myForm",autofocus:"",onSubmit:E(a.saveUser,["prevent"]),onReset:a.onReset},{default:t(()=>[s(V,null,{default:t(()=>[d("div",ce,[d("div",me,[s(u,{modelValue:a.editedUser.firstname,"onUpdate:modelValue":e[1]||(e[1]=l=>a.editedUser.firstname=l),type:"text",dense:"",label:"Nombre","lazy-rules":"",class:"col"},null,8,["modelValue"]),s(u,{modelValue:a.editedUser.lastname,"onUpdate:modelValue":e[2]||(e[2]=l=>a.editedUser.lastname=l),type:"text",dense:"",label:"Apellido",class:"col"},null,8,["modelValue"])]),d("div",ue,[s(u,{modelValue:a.editedUser.age,"onUpdate:modelValue":e[3]||(e[3]=l=>a.editedUser.age=l),type:"text",dense:"",label:"Edad",class:"col"},null,8,["modelValue"]),s(u,{modelValue:a.editedUser.gender,"onUpdate:modelValue":e[4]||(e[4]=l=>a.editedUser.gender=l),type:"text",dense:"",label:"Genero",class:"col"},null,8,["modelValue"]),s(u,{modelValue:a.editedUser.occupation,"onUpdate:modelValue":e[5]||(e[5]=l=>a.editedUser.occupation=l),type:"text",dense:"",label:"Ocupacion",class:"col"},null,8,["modelValue"])]),d("div",fe,[s(u,{modelValue:a.editedUser.email,"onUpdate:modelValue":e[6]||(e[6]=l=>a.editedUser.email=l),type:"email",dense:"",label:"Correo",rules:a.emailRules,"lazy-rules":"",class:"col"},null,8,["modelValue","rules"]),s(u,{modelValue:a.editedUser.school,"onUpdate:modelValue":e[7]||(e[7]=l=>a.editedUser.school=l),type:"text",dense:"",label:"Estudios",class:"col","lazy-rules":""},null,8,["modelValue"])])])]),_:1}),s(P,{align:"right"},{default:t(()=>[s(g,{flat:"",label:"Guardar",color:"primary",onClick:e[8]||(e[8]=l=>a.saveUser(a.editedUser))}),S(s(g,{flat:"",label:"Cancelar",color:"primary",type:"reset"},null,512),[[z]])]),_:1})]),_:1},8,["onSubmit","onReset"])]),_:1})]),_:1},8,["modelValue"]),s(R,{modelValue:a.dialog_access,"onUpdate:modelValue":e[16]||(e[16]=l=>a.dialog_access=l)},{default:t(()=>[s(A,{class:"items-center justify-center"},{default:t(()=>[s(V,null,{default:t(()=>[ve]),_:1}),s(D,{ref:"accessForm",onSubmit:e[15]||(e[15]=E(l=>r.userAccess(),["prevent"])),onReset:a.onReset},{default:t(()=>[s(V,null,{default:t(()=>[d("div",ge,[s(u,{modelValue:a.editedAccess.password,"onUpdate:modelValue":e[11]||(e[11]=l=>a.editedAccess.password=l),label:"Contrase\xF1a",type:a.ispassword?"password":"text",dense:"","lazy-rules":""},{prepend:t(()=>[s(p,{name:"lock"})]),append:t(()=>[s(p,{name:a.ispassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[10]||(e[10]=l=>a.ispassword=!a.ispassword)},null,8,["name"])]),_:1},8,["modelValue","type"]),s(u,{modelValue:a.editedAccess.passwordconfirm,"onUpdate:modelValue":e[13]||(e[13]=l=>a.editedAccess.passwordconfirm=l),label:"Confirmar contrase\xF1a",type:a.ispassword?"password":"text",rules:a.passwordConfirmRules,disable:!a.validatePasswor(a.editedAccess.password),dense:""},{prepend:t(()=>[s(p,{name:"lock"})]),append:t(()=>[s(p,{name:a.ispassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[12]||(e[12]=l=>a.ispassword=!a.ispassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules","disable"]),d("div",{class:Y(["password-criteria q-pa-md",r.$q.dark.isActive?"bg_dark":"bg_normal"])},[pe,d("div",null,[s(p,{name:a.validPassword.length?"check_circle":"cancel",color:a.validPassword.length?"positive":"negative"},null,8,["name","color"]),_(" Debe tener al menos 6 caracteres de largo. ")]),d("div",null,[s(p,{name:a.validPassword.capital?"check_circle":"cancel",color:a.validPassword.capital?"positive":"negative"},null,8,["name","color"]),_(" Debe contener al menos una letra may\xFAscula. ")]),d("div",null,[s(p,{name:a.validPassword.number?"check_circle":"cancel",color:a.validPassword.number?"positive":"negative"},null,8,["name","color"]),_(" Debe contener al menos un n\xFAmero. ")]),d("div",null,[s(p,{name:a.validPassword.symbol?"check_circle":"cancel",color:a.validPassword.symbol?"positive":"negative"},null,8,["name","color"]),_(" Debe contener al menos un caracter especial: !@#$%^&*()-_+= ")])],2),s(Q,{inset:""})])]),_:1}),s(P,{align:"right"},{default:t(()=>[s(g,{flat:"",label:"Guardar",color:"primary",onClick:e[14]||(e[14]=l=>a.saveAcces(a.editedAccess))}),S(s(g,{flat:"",label:"Cancelar",color:"primary",type:"reset"},null,512),[[z]])]),_:1})]),_:1},8,["onReset"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var xe=L(te,[["render",we]]);export{xe as default};
