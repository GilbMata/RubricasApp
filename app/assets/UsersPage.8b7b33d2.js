import{Q as F,a as O}from"./QList.578d8c0d.js";import{b as k,c as N,a as I,C as Q,g as j,_ as H,E as Z,r as c,z as L,aM as W,ay as p,G as C,H as J,I as i,J as a,L as _,aN as x,P as f,aO as A,aP as V,R as q,M as P,S as r,aC as v,aQ as S,n as R,aR as E,aS as K,Q as g,aT as X}from"./index.302b6eaf.js";import{Q as Y,C as D}from"./ClosePopup.47e99ea6.js";import{Q as $}from"./QSelect.c83c1a9a.js";import{Q as z}from"./QForm.ac6d8203.js";import{Q as ee}from"./QPage.9da0b17f.js";import{U}from"./userService.3498458a.js";import"./QChip.c0577f4d.js";import"./selection.d8d846f4.js";import"./QItem.89604af6.js";import"./format.2bc25e5f.js";import"./authHeader.38407fc4.js";const ae=k("div",{class:"q-space"});var le=N({name:"QSpace",setup(){return()=>ae}}),se=N({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(t,{slots:l}){const y=j(),e=I(()=>"q-td"+(t.autoWidth===!0?" q-table--col-auto-width":"")+(t.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(t.props===void 0)return k("td",{class:e.value},Q(l.default));const m=y.vnode.key,u=(t.props.colsMap!==void 0?t.props.colsMap[m]:null)||t.props.col;if(u===void 0)return;const{row:s}=t.props;return k("td",{class:e.value+u.__tdClass(s),style:u.__tdStyle(s)},Q(l.default))}}});const oe=[{name:"firstname",label:"Nombre",field:"firstname",align:"left",sortable:!0},{name:"apellido",label:"Apellido",field:"lastname",align:"left",sortable:!0},{name:"email",label:"Correo",field:"email",align:"left"},{name:"age",label:"Edad",field:"age",align:"center"},{name:"gender",label:"Genero",field:"gender",align:"center"},{name:"occupation",label:"Occupacion",field:"occupation",align:"center"},{name:"school",label:"Estudios",field:"school",align:"center"},{name:"action",label:"Actions",field:"action",align:"center"}],te={setup(){Z();const t=c(null);var l=c([]),y=c(!1),e=c(!1),m=c({firstname:"",lastname:"",age:"",gender:"",occupation:"",school:"",email:""});const u=["M","F"];var s=c({}),h=c({password:"",passwordconfirm:""});L(()=>{b(!0)});const n=c({length:!1,capital:!1,number:!1,symbol:!1,same:!1});return{optionsGene:u,dialog_add:y,dialog_access:e,columns:oe,users:l,editedUser:m,accesUser:s,editedAccess:h,saveAcces:G,ispassword:c(!0),valid:!1,roles:["Admin","User"],myForm:t,getUsers:b,saveUser:B,onReset:T,nameRules:[o=>!!o||"Se requiere el nombre",o=>o&&o.length>=5||"El nombre debe ser mas de 5 caracteres"],email:"",emailRules:[o=>!!o||"Correo electr\xF3nico es requerido",o=>/^[\w-]+@([\w-]+\.)+[\w-]{2,4}$/.test(o)||"El email debe ser v\xE1lido"],passwordRules:[o=>!!o||"Se requiere contrase\xF1a",o=>/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z])(?=.*[^\w\d\s]).{6,}$/.test(o)||"La contrase\xF1a debe contener al menos una letra min\xFAscula, un n\xFAmero, un car\xE1cter especial y una letra may\xFAscula"],passwordConfirmRules:[o=>o&&o===m.value.password||"Debe coincidir con la contrase\xF1a."],validatePasswor:M,validPassword:n,delUser(o){W.create({title:"Eliminar!",message:"\xBFDeseas eliminar el usuario?"}).onOk(()=>{U.delUser(o.uuid).then(d=>{p.create({icon:"done",color:"positive",message:"Registro borrado"})}).catch(d=>{p.create({icon:"error",color:"negative",message:"Error en la solicitud"})}).finally(b())})}};function T(){m.value={},h.value={},y.value=!1}function b(o=!1){U.allUser().then(d=>{console.log("\u{1F680} ~ .then ~ response:",d),l.value=d.users,o&&p.create({icon:"done",color:"positive",message:"Datos cargados",timeout:1500})}).catch(d=>{console.log(d),p.create({icon:"report_problem",color:"negative",message:"Error de conexi\xF3n",progress:!0})})}function B(o){console.log("\u{1F680} ~ saveUser ~ user",o),t.value.validate().then(d=>{d?(o.uuid?U.editUser(o).then(w=>{w.status==200?(m.value={},this.showEditDialog(),this.snackbar={text:"Usuario actualizado",show:!0}):console.log(w.message)}):U.saveUser(o).then(w=>{m.value={},p.create({icon:"done",color:"positive",message:"Usuario guardado"}),this.dialog_add=!1}).catch(w=>{console.log(w),p.create({icon:"error",color:"negative",message:w})}).finally(b()),b()):console.log("\u{1F680} ~ Form validate ~ Error")})}function G(o){o&&U.saveAccess(o).then(d=>{p.create({icon:"done",color:"positive",message:"Accesos actualizados"}),this.dialog_access=!1}).catch(d=>{console.log("\u{1F680} ~ UserService.saveAccess ~ error:",d)}).finally(b())}function M(o){if(!!o)return n.value.length=o.length>=6,n.value.capital=/^(?=.*[A-Z]).*$/.test(o),n.value.number=/^(?=.*[0-9]).*$/.test(o),n.value.symbol=/^(?=.*[^\w\d\s]).*$/.test(o),n.value.same=this.editedAccess.password===this.editedAccess.passwordconfirm,n.value.length&&n.value.capital&&n.value.number&&n.value.symbol}},methods:{editUser(t){console.log("\u{1F680} ~ editUser ~ user:",t),this.editedUser=t||{},this.dialog_add=!this.dialog_add,!t&&this.dialog_add==!1&&this.getUsers()},editAccess(t){this.editedAccess.uuid=t.uuid,this.editedAccess.rol=t.roles[0].name,this.dialog_access=!this.dialog_access,!t&&this.dialog_add==!1&&this.getUsers()},showEditpassword(t){t?this.editpassword.id=t:(this.editpassword={},this.pass2=""),this.dialog2=!this.dialog2},savePass(t){console.log(t),t.id&&U.editUser(t).then(l=>{l.status==200?(this.editedUser={},this.showEditpassword(),this.snackbar={text:"Contrase\xF1a actualizada",color:"success",show:!0}):console.log(l)})}}},ie=r("div",null,"\xA1No se encontr\xF3 ning\xFAn dato!",-1),re={key:0,class:"text-h6 text-center"},de={key:1,class:"text-h5 text-center q-pt-xs"},ne={class:"q-pa-md q-gutter-y-md"},ce={class:"row wrap q-gutter-md"},me={class:"row wrap q-gutter-md"},ue={class:"row q-gutter-md"},fe=r("div",{class:"text-h5 text-center"},"Accesos",-1),ve={class:"q-pa- q-gutter-y-md"},ge=r("div",{class:"text-subtitle2 q-mb-sm"}," Criterios de contrase\xF1a: ",-1);function pe(t,l,y,e,m,u){return C(),J(ee,{padding:""},{default:i(()=>[a(A,{class:"q-pa-xs"},{default:i(()=>[a(Y,{dense:"",title:"Usuarios",rows:e.users,columns:e.columns,"row-key":"name","items-per-page":10,"sort-by":"firstname"},{top:i(()=>[a(F,{class:"shdow-1"},{default:i(()=>[a(O,null,{default:i(()=>[_(" Usuarios ")]),_:1}),a(le),a(x,{inset:""}),a(f,{color:"primary",label:"Agregar",icon:"fa-solid fa-plus",onClick:l[0]||(l[0]=s=>e.dialog_add=!0)})]),_:1})]),"no-data":i(()=>[ie]),"body-cell-action":i(s=>[a(se,{props:s},{default:i(()=>[a(f,{dense:"",flat:"",color:"yellow",field:"access",icon:"fa-solid fa-key",onClick:h=>u.editAccess(s.row)},null,8,["onClick"]),a(f,{dense:"",flat:"",color:"primary",field:"edit",icon:"fa-solid fa-pencil",onClick:h=>u.editUser(s.row)},null,8,["onClick"]),a(f,{dense:"",flat:"",color:"negative",field:"edit",icon:"fa-solid fa-trash-can",onClick:h=>e.delUser(s.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1}),a(E,{modelValue:e.dialog_add,"onUpdate:modelValue":l[9]||(l[9]=s=>e.dialog_add=s),persistent:"","transition-show":"flip-down","transition-hide":"flip-up"},{default:i(()=>[a(A,{class:"items-center justify-center"},{default:i(()=>[a(V,null,{default:i(()=>[e.editedUser.uuid?(C(),q("div",re," Editando: "+P(e.editedUser.firstname)+" "+P(e.editedUser.lastname),1)):(C(),q("div",de,"Nuevo"))]),_:1}),a(z,{ref:"myForm",onSubmit:e.saveUser,onReset:e.onReset},{default:i(()=>[a(V,null,{default:i(()=>[r("div",ne,[r("div",ce,[a(v,{modelValue:e.editedUser.firstname,"onUpdate:modelValue":l[1]||(l[1]=s=>e.editedUser.firstname=s),type:"text",dense:"",label:"Nombre",rules:e.nameRules,class:"col"},null,8,["modelValue","rules"]),a(v,{modelValue:e.editedUser.lastname,"onUpdate:modelValue":l[2]||(l[2]=s=>e.editedUser.lastname=s),type:"text",dense:"",label:"Apellido",class:"col"},null,8,["modelValue"])]),r("div",me,[a(v,{modelValue:e.editedUser.age,"onUpdate:modelValue":l[3]||(l[3]=s=>e.editedUser.age=s),type:"number",dense:"",label:"Edad",class:"col"},null,8,["modelValue"]),a($,{modelValue:e.editedUser.gender,"onUpdate:modelValue":l[4]||(l[4]=s=>e.editedUser.gender=s),options:e.optionsGene,dense:"",label:"Genero",class:"col"},null,8,["modelValue","options"]),a(v,{modelValue:e.editedUser.occupation,"onUpdate:modelValue":l[5]||(l[5]=s=>e.editedUser.occupation=s),type:"text",dense:"",label:"Ocupaci\xF3n",class:"col"},null,8,["modelValue"])]),r("div",ue,[a(v,{modelValue:e.editedUser.email,"onUpdate:modelValue":l[6]||(l[6]=s=>e.editedUser.email=s),type:"email",dense:"",label:"Correo",rules:e.emailRules,"lazy-rules":"",class:"col"},null,8,["modelValue","rules"]),a(v,{modelValue:e.editedUser.school,"onUpdate:modelValue":l[7]||(l[7]=s=>e.editedUser.school=s),type:"text",dense:"",label:"Estudios",class:"col","lazy-rules":""},null,8,["modelValue"])])])]),_:1}),a(S,{align:"right"},{default:i(()=>[a(f,{flat:"",label:"Guardar",color:"primary",onClick:l[8]||(l[8]=s=>e.saveUser(e.editedUser))}),R(a(f,{flat:"",label:"Cancelar",color:"primary",type:"reset"},null,512),[[D]])]),_:1})]),_:1},8,["onSubmit","onReset"])]),_:1})]),_:1},8,["modelValue"]),a(E,{modelValue:e.dialog_access,"onUpdate:modelValue":l[16]||(l[16]=s=>e.dialog_access=s)},{default:i(()=>[a(A,{class:"items-center justify-center"},{default:i(()=>[a(V,null,{default:i(()=>[fe]),_:1}),a(z,{ref:"accessForm",onSubmit:l[15]||(l[15]=K(s=>t.userAccess(),["prevent"])),onReset:e.onReset},{default:i(()=>[a(V,null,{default:i(()=>[r("div",ve,[a(v,{modelValue:e.editedAccess.password,"onUpdate:modelValue":l[11]||(l[11]=s=>e.editedAccess.password=s),label:"Contrase\xF1a",type:e.ispassword?"password":"text",dense:"","lazy-rules":""},{prepend:i(()=>[a(g,{name:"lock"})]),append:i(()=>[a(g,{name:e.ispassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[10]||(l[10]=s=>e.ispassword=!e.ispassword)},null,8,["name"])]),_:1},8,["modelValue","type"]),a(v,{modelValue:e.editedAccess.passwordconfirm,"onUpdate:modelValue":l[13]||(l[13]=s=>e.editedAccess.passwordconfirm=s),label:"Confirmar contrase\xF1a",type:e.ispassword?"password":"text",rules:e.passwordConfirmRules,disable:!e.validatePasswor(e.editedAccess.password),dense:""},{prepend:i(()=>[a(g,{name:"lock"})]),append:i(()=>[a(g,{name:e.ispassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[12]||(l[12]=s=>e.ispassword=!e.ispassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules","disable"]),r("div",{class:X(["password-criteria q-pa-md",t.$q.dark.isActive?"bg_dark":"bg_normal"])},[ge,r("div",null,[a(g,{name:e.validPassword.length?"check_circle":"cancel",color:e.validPassword.length?"positive":"negative"},null,8,["name","color"]),_(" Debe tener al menos 6 caracteres de largo. ")]),r("div",null,[a(g,{name:e.validPassword.capital?"check_circle":"cancel",color:e.validPassword.capital?"positive":"negative"},null,8,["name","color"]),_(" Debe contener al menos una letra may\xFAscula. ")]),r("div",null,[a(g,{name:e.validPassword.number?"check_circle":"cancel",color:e.validPassword.number?"positive":"negative"},null,8,["name","color"]),_(" Debe contener al menos un n\xFAmero. ")]),r("div",null,[a(g,{name:e.validPassword.symbol?"check_circle":"cancel",color:e.validPassword.symbol?"positive":"negative"},null,8,["name","color"]),_(" Debe contener al menos un caracter especial: !@#$%^&*()-_+= ")])],2),a(x,{inset:""})])]),_:1}),a(S,{align:"right"},{default:i(()=>[a(f,{flat:"",label:"Guardar",color:"primary",onClick:l[14]||(l[14]=s=>e.saveAcces(e.editedAccess))}),R(a(f,{flat:"",label:"Cancelar",color:"primary",type:"reset"},null,512),[[D]])]),_:1})]),_:1},8,["onReset"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var qe=H(te,[["render",pe]]);export{qe as default};
